<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="I denne note behandles et simpelt neuralt netværk uden skjulte lag, men hvor det til genæld er muligt at klassificere mere end to klasser. At kunne prædiktere en mulig klasse blandt flere bruges blandt andet i de store sprogmodeller.">

<title>Simple kunstige neurale netværk til multipel klassifikation – AI MAT - matematikken bag magien</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../logo/SVG/Bomaerke_05_AIMAT_2024.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-f566325cf577907e9eaf893566fd6138.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-Y219BCPS45"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
 
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'analytics_storage': 'denied'
  });
gtag('config', 'G-Y219BCPS45', { 'anonymize_ip': true});
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../logo/PNG/Logo_multi_AIMAT_RGB_2024.png" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../undervisningsforlob.html"> 
<span class="menu-text">Undervisningsforløb</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../materialer.html"> 
<span class="menu-text">Materialer</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../sro.html"> 
<span class="menu-text">SRO</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../srp.html"> 
<span class="menu-text">SRP</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../apps.html"> 
<span class="menu-text">Apps</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../referencer.html"> 
<span class="menu-text">Referencer</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">Om os</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.youtube.com/@ai-mat"> 
<span class="menu-text"><img src="../../logo/YouTube/youtube-color-darkblue-icon.svg" style="height:2em"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Indhold</h2>
   
  <ul>
  <li><a href="#hvor-hårdt-skal-du-arbejde-i-matematiktimerne" id="toc-hvor-hårdt-skal-du-arbejde-i-matematiktimerne" class="nav-link active" data-scroll-target="#hvor-hårdt-skal-du-arbejde-i-matematiktimerne">Hvor hårdt skal du arbejde i matematiktimerne?</a></li>
  <li><a href="#træningsdata" id="toc-træningsdata" class="nav-link" data-scroll-target="#træningsdata">Træningsdata</a></li>
  <li><a href="#feedforward" id="toc-feedforward" class="nav-link" data-scroll-target="#feedforward">Feedforward</a></li>
  <li><a href="#cross-entropy-tabsfunktionen" id="toc-cross-entropy-tabsfunktionen" class="nav-link" data-scroll-target="#cross-entropy-tabsfunktionen">Cross-entropy tabsfunktionen</a></li>
  <li><a href="#opdatering-af-vægtene" id="toc-opdatering-af-vægtene" class="nav-link" data-scroll-target="#opdatering-af-vægtene">Opdatering af vægtene</a>
  <ul class="collapse">
  <li><a href="#opdatering-ved-hjælp-af-hele-træningsdatasættet" id="toc-opdatering-ved-hjælp-af-hele-træningsdatasættet" class="nav-link" data-scroll-target="#opdatering-ved-hjælp-af-hele-træningsdatasættet">Opdatering ved hjælp af hele træningsdatasættet</a></li>
  </ul></li>
  <li><a href="#tilbage-til-eksemplet" id="toc-tilbage-til-eksemplet" class="nav-link" data-scroll-target="#tilbage-til-eksemplet">Tilbage til eksemplet</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Simple kunstige neurale netværk til multipel klassifikation</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Et kunstigt neuralt netværk fungerer på den måde, at man på baggrund af en række forskellige informationer gerne vil kunne forudsige en eller anden ting. Det kan være, at man på baggrund af en række forskellige blodprøveværdier vil forudsige, om en patient har en bestemt sygdom. Det kunne også være, at man baseret på svarene fra en række forskellige spørgsgmål vil udtale sig om, om en person vil stemme på rød eller blå blok. De nævnte eksempler kalder man for <em>binær klassifikation</em> – fordi der i hvert tilfælde er to muligheder: <em>syg</em>/<em>ikke syg</em> og <em>rød blok</em>/<em>blå blok</em>. Men det er ikke svært at forestille sig scenarier, hvor der kan være mere end to klasser. For eksempel er eksemplet med rød og blå nok tvivlsomt. Her ville det måske være bedre at prøve at forudsige et bestemt parti. Denne note handler om, hvordan man udvider en simpel <a href="../../materialer/kunstige_neuroner/kunstige_neuroner.html">kunstig neuron</a>, så den ikke kun kan bruges til binær klassifikation, men derimod til at forudsige hvilke blandt flere klasser et givent tilfælde befinder sig i. Lad os starte med et eksempel.</p>
<section id="hvor-hårdt-skal-du-arbejde-i-matematiktimerne" class="level2">
<h2 class="anchored" data-anchor-id="hvor-hårdt-skal-du-arbejde-i-matematiktimerne">Hvor hårdt skal du arbejde i matematiktimerne?</h2>
<p>Du kender det sikkert godt. Der er gruppearbejde i matematiktimen, og du gider egentlig ikke. Det er nemmere bare at snige sin mobiltelefon i lommen og drible i kantinen. På den anden side er du også ambitiøs og vil gerne have en god karakter til eksamen. What to do?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/matematiktime.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
<p>Lad os sige at du svarer på følgende tre spørgsmål på en skala fra 1 til 10:</p>
<ul>
<li><p><span class="math inline">\(x_1\)</span>: Hvor godt har jeg sovet i nat? (1="Elendigt", 10="Fantastisk").</p></li>
<li><p><span class="math inline">\(x_2\)</span>: Hvor spændende er det emne, vi er i gang med lige nu? (1="Mega kedeligt", 10="Det er awesome").</p></li>
<li><p><span class="math inline">\(x_3\)</span>: Hvor godt vil jeg gerne klare mig til eksamen? (1="Jeg er ligeglad", 10="Det skal gå så godt som muligt").</p></li>
</ul>
<p>Baseret på disse tre spørgsmål er der nu følgende fire valg, du kan træffe:</p>
<ol type="1">
<li>Jeg bliver i klassen, hvor læreren kan hjælpe mig, og regner alt det, jeg kan.</li>
<li>Jeg sætter mig ud og regner opgaverne, så godt jeg kan.</li>
<li>Jeg går i kantinen og sniger min telefon med – jeg prøver at regne nogle få opgaver.</li>
<li>Jeg går hjem (og håber på ikke at få fravær)!</li>
</ol>
<p>Det valg du træffer, skal vi have oversat til matematik (beklager, men nu er det jo en matematik tekst, du er i gang med at læse!). Det gør vi ved at definere fire forskellige værdier <span class="math inline">\(t_1, t_2, t_3, t_4\)</span>.</p>
<p>Hvis du vælger 1. sætter vi: <span class="math display">\[
t_1 = 1, \quad t_2=0, \quad t_3=0, \quad t_4=0.
\]</span></p>
<p>Hvis du vælger 2. sætter vi: <span class="math display">\[
t_1 = 0, \quad t_2=1, \quad t_3=0, \quad t_4=0.
\]</span></p>
<p>Hvis du vælger 3. sætter vi: <span class="math display">\[
t_1 = 0, \quad t_2=0, \quad t_3=1, \quad t_4=0.
\]</span></p>
<p>Hvis du vælger 4. sætter vi: <span class="math display">\[
t_1 = 0, \quad t_2=0, \quad t_3=0, \quad t_4=1.
\]</span></p>
<p>Det kan man repræsentere lidt smart ved hjælp af en vektor i fire dimensioner:</p>
<p><span class="math display">\[
\vec{t}=
\begin{pmatrix}
t_1 \\
t_2 \\
t_3 \\
t_4 \\
\end{pmatrix}
\]</span></p>
<p>Vektoren <span class="math inline">\(\vec t\)</span> kaldes for <strong>targetværdien</strong> eller <strong>targetvektoren</strong>.</p>
<p>Læg mærke til, at der altid gælder følgende</p>
<p><span id="eq-one_not"><span class="math display">\[
t_1 + t_2 + t_3 + t_4 = 1.
\tag{1}\]</span></span></p>
<p>På grund af denne egenskab kalder man også <span class="math inline">\(\vec{t}\)</span> for en <strong>one hot vektor</strong>. Det får vi brug for senere.</p>
</section>
<section id="træningsdata" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="træningsdata">Træningsdata</h2>
<p>Vi forestiller os nu, at vi har stillet 12 elever de tre spørgsmål ovenfor. Derefter har vi observeret hvilket af de fire valg, de træffer. Det kunne se sådan her ud:</p>
<div id="tbl-trainingdata" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-tbl figure page-columns page-full">
<div aria-describedby="tbl-trainingdata-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">Elev nr.</th>
<th style="text-align: center;"><span class="math inline">\(x_1\)</span> (søvn)</th>
<th style="text-align: center;"><span class="math inline">\(x_2\)</span> (emne)</th>
<th style="text-align: center;"><span class="math inline">\(x_3\)</span> (eksamen)</th>
<th style="text-align: center;">Valg</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(1\)</span></td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#020873} 1}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(8\)</span></td>
<td style="text-align: center;"><span class="math inline">\(7\)</span></td>
<td style="text-align: center;"><span class="math inline">\(8\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#020873} 1}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(3\)</span></td>
<td style="text-align: center;"><span class="math inline">\(9\)</span></td>
<td style="text-align: center;"><span class="math inline">\(6\)</span></td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#020873} 1}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(4\)</span></td>
<td style="text-align: center;"><span class="math inline">\(4\)</span></td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#020873} 1}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(5\)</span></td>
<td style="text-align: center;"><span class="math inline">\(5\)</span></td>
<td style="text-align: center;"><span class="math inline">\(8\)</span></td>
<td style="text-align: center;"><span class="math inline">\(7\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#8086F2} 2}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(6\)</span></td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\(7\)</span></td>
<td style="text-align: center;"><span class="math inline">\(4\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#8086F2} 2}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(7\)</span></td>
<td style="text-align: center;"><span class="math inline">\(7\)</span></td>
<td style="text-align: center;"><span class="math inline">\(7\)</span></td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#8086F2} 2}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(8\)</span></td>
<td style="text-align: center;"><span class="math inline">\(8\)</span></td>
<td style="text-align: center;"><span class="math inline">\(3\)</span></td>
<td style="text-align: center;"><span class="math inline">\(4\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#F2B33D} 3}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(9\)</span></td>
<td style="text-align: center;"><span class="math inline">\(6\)</span></td>
<td style="text-align: center;"><span class="math inline">\(2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(5\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#F2B33D} 3}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\(2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(2\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#F2B33D} 3}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(11\)</span></td>
<td style="text-align: center;"><span class="math inline">\(1\)</span></td>
<td style="text-align: center;"><span class="math inline">\(1\)</span></td>
<td style="text-align: center;"><span class="math inline">\(3\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#F288B9} 4}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(12\)</span></td>
<td style="text-align: center;"><span class="math inline">\(5\)</span></td>
<td style="text-align: center;"><span class="math inline">\(2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(2\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#F288B9} 4}\)</span></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-tbl margin-caption" id="tbl-trainingdata-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabel&nbsp;1: Træningsdata fra 12 elever.
</figcaption>
</figure>
</div>
<p>For eksempel har elev nummer 1 sovet fantastisk, eleven synes at emnet er vildt spændende, og eleven vil gerne klare sig rigtig godt til eksamen – denne elev vælger derfor at blive i klassen. Targetværdien for denne elev er:</p>
<p><span class="math display">\[
\vec{t}=
\begin{pmatrix}
1 \\
0 \\
0 \\
0 \\
\end{pmatrix}
\]</span></p>
<p>Eleven nummer 12 har derimod sovet semi godt, til gengæld synes eleven ikke at emnet er særlig spændende, og er også ligeglad med at klare sig godt til eksamen. Denne elev laver derfor en "sniger" og går hjem. Targetværdien for eleven er derfor:</p>
<p><span class="math display">\[
\vec{t}=
\begin{pmatrix}
0 \\
0 \\
0 \\
1 \\
\end{pmatrix}
\]</span></p>
<p>Data i <a href="#tbl-trainingdata" class="quarto-xref">tabel&nbsp;1</a> kaldes for <strong>træningsdata</strong>.</p>
<p>I <a href="#fig-trainingdata" class="quarto-xref">figur&nbsp;1</a> er træningsdata indtegnet i et tre-dimensionelt koordinatsystem. Punkterne har koordinatsæt <span class="math inline">\((x_1, x_2, x_3)\)</span> og punktets farve angiver valget (mørkeblå svarer til 1, lyseblå svarer til 2, gul svarer til 3 og lyserød svarer til 4).</p>

<meta name="viewport" content="width=device-width,initial-scale=1">
<meta charset="utf-8">
<script src="https://cdn.geogebra.org/apps/deployggb.js"></script>

<!-- 
Alle geogebra filer placeres i mappen _geogebra
Erstat XXX med nr på app og erstat YYY med navn på ggb-fil -->
<script>
var parameters_trainingdata = {
"id": "ggbApplet_trainingdata",
"width":700,
"height":450,
"prerelease":false,
"borderColor":null,
"showMenuBar":false,
"showAlgebraInput":false,
"showToolBar":false,
"showToolBarHelp":false,
"showResetIcon":true,
"enableLabelDrags":false,
"enableShiftDragZoom":true,
"enableRightClick":false,
"errorDialogsActive":false,
"useBrowserForJS":false,
"capturingThreshold":null,
"language":"da",
// use this instead of ggbBase64 to load a .ggb file
 "filename":"_geogebra/trainingdata.ggb",
};
var applet_trainingdata = new GGBApplet(parameters_trainingdata, true);
</script>



<script>
var parameters_softmax = {
"id": "ggbApplet_softmax",
"width":700,
"height":450,
"prerelease":false,
"borderColor":null,
"showMenuBar":false,
"showAlgebraInput":false,
"showToolBar":false,
"showToolBarHelp":false,
"showResetIcon":true,
"enableLabelDrags":false,
"enableShiftDragZoom":true,
"enableRightClick":false,
"errorDialogsActive":false,
"useBrowserForJS":false,
"capturingThreshold":null,
"language":"da",
// use this instead of ggbBase64 to load a .ggb file
 "filename":"_geogebra/softmax.ggb",
};
var applet_softmax = new GGBApplet(parameters_softmax, true);
</script>



<script>
var parameters_trainingdata_prediction_wrong = {
"id": "ggbApplet_trainingdata_prediction_wrong",
"width":700,
"height":450,
"prerelease":false,
"borderColor":null,
"showMenuBar":false,
"showAlgebraInput":false,
"showToolBar":false,
"showToolBarHelp":false,
"showResetIcon":true,
"enableLabelDrags":false,
"enableShiftDragZoom":true,
"enableRightClick":false,
"errorDialogsActive":false,
"useBrowserForJS":false,
"capturingThreshold":null,
"language":"da",
// use this instead of ggbBase64 to load a .ggb file
 "filename":"_geogebra/trainingdata_prediction_wrong.ggb",
};
var applet_trainingdata_prediction_wrong = new GGBApplet(parameters_trainingdata_prediction_wrong, true);
</script>



<script>
var parameters_trainingdata_tre_nye_elever = {
"id": "ggbApplet_trainingdata_tre_nye_elever",
"width":700,
"height":450,
"prerelease":false,
"borderColor":null,
"showMenuBar":false,
"showAlgebraInput":false,
"showToolBar":false,
"showToolBarHelp":false,
"showResetIcon":true,
"enableLabelDrags":false,
"enableShiftDragZoom":true,
"enableRightClick":false,
"errorDialogsActive":false,
"useBrowserForJS":false,
"capturingThreshold":null,
"language":"da",
// use this instead of ggbBase64 to load a .ggb file
 "filename":"_geogebra/trainingdata_tre_nye_elever.ggb",
};
var applet_trainingdata_tre_nye_elever = new GGBApplet(parameters_trainingdata_tre_nye_elever, true);
</script>


<script>
window.onload = function() {
  applet_softmax.inject('ggbApplet_softmax');
  applet_trainingdata.inject('ggbApplet_trainingdata');
  applet_trainingdata_prediction_wrong.inject('ggbApplet_trainingdata_prediction_wrong');
  applet_trainingdata_tre_nye_elever.inject('ggbApplet_trainingdata_tre_nye_elever');
  }
</script>
<div id="fig-trainingdata" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-trainingdata-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ggbApplet_trainingdata">

</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-trainingdata-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figur&nbsp;1: Punktplot af træningsdata fra <a href="#tbl-trainingdata" class="quarto-xref">tabel&nbsp;1</a>. Punkternes farve angiver valget (mørkeblå svarer til 1, lyseblå svarer til 2, gul svarer til 3 og lyserød svarer til 4).
</figcaption>
</figure>
</div>
<p>Det, vi gerne vil nu, er at lave et meget simpelt kunstigt neuralt netværk, som vi fremover kan bruge til at forudsige, hvilket valg du skal træffe baseret på svaret på de tre spørgsmål. Så idéen er altså, at du i et fremtidsscenarie svarer på de tre spørgsmål, og så fortæller din nye AI assistent dig, hvilket valg du skal træffe. Det er da smart – eller måske lidt dumt, men nu er det jo også bare et eksempel!</p>
<p>Lad os forklare, hvordan man kan gøre det – blot i et lidt mere generelt tilfælde.</p>
</section>
<section id="feedforward" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="feedforward">Feedforward</h2>
<p>Vi forestiller os, at vi generelt har <span class="math inline">\(n\)</span> inputvariable</p>
<p><span class="math display">\[
x_1, x_2, \dots, x_n.
\]</span></p>
<p>I eksemplet ovenfor var <span class="math inline">\(n=3\)</span>, fordi vi svarede på tre spørgsmål.</p>
<p>Disse <span class="math inline">\(n\)</span> inputvariable er vist i <a href="#fig-netvaerk_generelt" class="quarto-xref">figur&nbsp;2</a> som lilla cirkler. De grønne cirkler repræsenterer <span class="math inline">\(J\)</span> output neuroner (i vores eksempel er <span class="math inline">\(J=4\)</span>, fordi der skal træffes et valg blandt 4 muligheder).</p>
<div id="fig-netvaerk_generelt" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-netvaerk_generelt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/netvaerk_generelt.png" class="img-fluid figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-netvaerk_generelt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figur&nbsp;2: Neuralt netværk med <span class="math inline">\(n\)</span> input neuroner og <span class="math inline">\(m\)</span> output neuroner.
</figcaption>
</figure>
</div>
<p>Vi ønsker at træne netværket, så <span class="math inline">\(o_1\)</span> bliver sandsynligheden for at et givent træningseksempel tilhører klasse <span class="math inline">\(1\)</span>, <span class="math inline">\(o_2\)</span> skal være sandsynligheden for at træningseksemplet tilhører klasse <span class="math inline">\(2\)</span> og så videre. Hvis man vil skrive det lidt kompakt op, kan man samle alle outputværdierne i en vektor:</p>
<p><span class="math display">\[
\vec{o} =
\begin{pmatrix}
o_1 \\
o_2 \\
\vdots \\
o_J
\end{pmatrix}
\]</span></p>
<p>I vores eksempel vil det svare til, at <span class="math inline">\(o_1\)</span> skal være sandsynligheden for, at du bliver i klassen og regner opgaver (mulighed 1), <span class="math inline">\(o_2\)</span> skal være sandsynligheden for, at du sætter dig ud og regner opgaver og så videre.</p>
<p>Det vil sige, at det skal være sådan, at</p>
<p><span class="math display">\[
o_1 + o_2 + \cdots + o_J = 1
\]</span></p>
<p>fordi sandsynlighederne for de <span class="math inline">\(J\)</span> forskellige muligheder til sammen skal give 1.</p>
<p>Vi vil starte med at se på, hvordan vi på baggrund af inputvariablene <span class="math inline">\(x_1, x_2, \cdots, x_n\)</span> kan beregne de <span class="math inline">\(J\)</span> outputværdier, så ovenstående er opfyldt. På <a href="#fig-netvaerk_generelt" class="quarto-xref">figur&nbsp;2</a> illustrerer de forskelligt farvede pile, at alle <span class="math inline">\(n\)</span> inputvariable sendes frem i netværket til alle <span class="math inline">\(J\)</span> outputværdier. Så for eksempel sendes <span class="math inline">\(x_1, x_2, \cdots, x_n\)</span> frem til <span class="math inline">\(o_1\)</span> (vist ved de lyseblå pile), ligesom de også sendes frem til <span class="math inline">\(o_2\)</span> (vist ved de mellemblå pile) og så videre.</p>
<p>For at forklare den beregning der så foregår, har vi i <a href="#fig-netvaerk_generelt_wj" class="quarto-xref">figur&nbsp;3</a> kun vist de pile, som går fra inputvariablene frem til den <span class="math inline">\(j\)</span>’te outputværdi.</p>
<div id="fig-netvaerk_generelt_wj" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-netvaerk_generelt_wj-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/netvaerk_generelt_wj.png" class="img-fluid figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-netvaerk_generelt_wj-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figur&nbsp;3: Neuralt netværk hvor vægtene fra de <span class="math inline">\(n\)</span> input neuroner over til den <span class="math inline">\(j\)</span>’te output neuron er vist.
</figcaption>
</figure>
</div>
<p>Før <span class="math inline">\(o_j\)</span> bestemmes, beregner vi først en værdi <span class="math inline">\(z_j\)</span> på denne måde:</p>
<p><span class="math display">\[
z_j = w_{j,0} + w_{j,1} \cdot x_1 + w_{j,2} \cdot x_2 + \cdots + w_{j,n} \cdot x_n.
\]</span></p>
<p>Tallene <span class="math inline">\(w_{j,0}, w_{j,1}, w_{j,2}, \cdots, w_{j,n}\)</span> kaldes for <strong>vægte</strong>.</p>
<p>Værdien <span class="math inline">\(z_j\)</span> er vist i <a href="#fig-netvaerk_generelt_wj" class="quarto-xref">figur&nbsp;3</a> inde i den grønne cirkel. På tilsvarende vis beregnes <span class="math inline">\(z_1, z_2, \cdots, z_J\)</span>. Bemærk her, at vægtene er forskellige. For eksempel er</p>
<p><span class="math display">\[
z_2 = w_{2,0} + w_{2,1} \cdot x_1 + w_{2,2} \cdot x_2 + \cdots + w_{2,n} \cdot x_n
\]</span></p>
<p>så vægtene er her <span class="math inline">\(w_{2,0}, w_{2,1}, w_{2,2}, \cdots, w_{2,n}\)</span>.</p>
<p>I alt er der <span class="math inline">\((n+1)\cdot J\)</span> forskellige vægte (det vil sige i vores eksempel vil der være <span class="math inline">\((3+1)\cdot4=16\)</span> vægte).</p>
<p>Alle <span class="math inline">\(z\)</span>-værdierne kan antage et hvilket som helst reelt tal og kan alene af den grund ikke fortolkes som en sandsynlighed. Vi bruger derfor en såkaldt <strong>aktiveringsfunktion</strong> <span class="math inline">\(\alpha\)</span> på alle <span class="math inline">\(z\)</span>-værdierne, så vi kan få beregnet en outputværdi, som kan fortolkes som en sandsynlighed:</p>
<p><span class="math display">\[
o_j = \alpha(z_j),
\]</span></p>
<p>hvor</p>
<p><span class="math display">\[
0 \leq \alpha(z_j) \leq 1.
\]</span></p>
<p>Som aktiveringsfunktion <span class="math inline">\(\alpha\)</span> vil vi bruge en funktion, som kaldes for <strong>softmax</strong>, fordi den præcis har de egenskaber, som vi efterspørger – det ser vi lige om lidt. På baggrund af alle <span class="math inline">\(z\)</span>-værdierne beregnes <span class="math inline">\(o_j\)</span> ved hjælp af <strong>softmax</strong> på denne måde:</p>
<p><span class="math display">\[
o_j = \alpha(z_j) = \frac{e^{z_j}}{\sum_{i=1}^J e^{z_i}}.
\]</span></p>
<p>For det første kan vi se, at både tæller og nævner er positive. Derfor må <span class="math inline">\(o_j&gt;0\)</span>. For det andet er <span class="math inline">\(e^{z_j} &lt; \sum_{i=1}^J e^{z_i}\)</span> og derfor er</p>
<p><span class="math display">\[
o_j =  \frac{e^{z_j}}{\sum_{i=1}^J e^{z_i}} &lt; \frac{\sum_{i=1}^J e^{z_i}}{\sum_{i=1}^J e^{z_i}} = 1.
\]</span></p>
<p>Altså er</p>
<p><span class="math display">\[
0&lt;o_j&lt;1
\]</span></p>
<p>hvilket betyder, at <span class="math inline">\(o_j\)</span> kan opfattes som en sandsynlighed. Endelig er</p>
<p><span class="math display">\[
\begin{aligned}
o_1 + o_2 + \cdots + o_J &amp;= \frac{e^{z_1}}{\sum_{i=1}^J e^{z_i}} + \frac{e^{z_2}}{\sum_{i=1}^J e^{z_i}} + \cdots + \frac{e^{z_J}}{\sum_{i=1}^J e^{z_i}} \\
&amp;= \frac{e^{z_1} + e^{z_2} + \cdots + e^{z_J}}{\sum_{i=1}^J e^{z_i}} \\
&amp;= \frac{\sum_{i=1}^J e^{z_i}}{\sum_{i=1}^J e^{z_i}} = 1,
\end{aligned}
\]</span></p>
<p>hvilket også var et krav til de beregnede outputværdier.</p>
<p>I det helt specielle tilfælde, hvor der kun er to output neuroner, vil softmax-funktionen for <span class="math inline">\(o_1\)</span> blot være en funktion af to variable:</p>
<p><span class="math display">\[
o_1 = \frac{e^{z_1}}{e^{z_1} + e^{z_2}}
\]</span></p>
<p>Grafen for denne funktion er vist i <a href="#fig-softmax" class="quarto-xref">figur&nbsp;4</a>. Her ses det tydeligt, at værdien af <span class="math inline">\(o_1\)</span> ligger i intervallet <span class="math inline">\(]0,1[\)</span>.</p>
<div id="fig-softmax" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-softmax-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ggbApplet_softmax">

</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-softmax-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figur&nbsp;4: Grafen for softmax funktionen <span class="math inline">\(o_1 = \frac{e^{z_1}}{e^{z_1} + e^{z_2}}\)</span>.
</figcaption>
</figure>
</div>
<p>Det betyder, at hvis <span class="math inline">\(o\)</span>-værdierne beregnes på denne måde, er der altså tale om en sandsynlighedsfordeling. Beregningen af alle <span class="math inline">\(z\)</span>- og <span class="math inline">\(o\)</span>-værdier kan udføres, hvis bare man kender alle vægtene. I et neuralt netværk kaldes disse udregninger for <strong>feedforward</strong> og er opsummeret herunder.</p>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Feedforward-udtryk
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>På baggrund af inputværdierne <span class="math inline">\(x_1, x_2, \cdots, x_n\)</span> beregnes først <span class="math inline">\(z\)</span>-værdier:</p>
<p><span id="eq-z_j"><span class="math display">\[
\begin{aligned}
z_1 &amp;= w_{1,0} + w_{1,1} \cdot x_1 + w_{1,2} \cdot x_2 + \cdots + w_{1,n} \cdot x_n \\
&amp; \,\,\, \vdots \\
z_j &amp;= w_{j,0} + w_{j,1} \cdot x_1 + w_{j,2} \cdot x_2 + \cdots + w_{j,n} \cdot x_n \\
&amp; \,\,\, \vdots \\
z_J &amp;= w_{J,0} + w_{J,1} \cdot x_1 + w_{J,2} \cdot x_2 + \cdots + w_{J,n} \cdot x_n \\
\end{aligned}
\tag{2}\]</span></span></p>
<p>Herefter beregnes outputværdierne:</p>
<p><span id="eq-o_j"><span class="math display">\[
\begin{aligned}
o_1 &amp;= \frac{e^{z_1}}{\sum_{i=1}^J e^{z_i}} \\
&amp; \,\,\, \vdots \\
o_j &amp;= \frac{e^{z_j}}{\sum_{i=1}^J e^{z_i}} \\
&amp; \,\,\, \vdots \\
o_J &amp;= \frac{e^{z_J}}{\sum_{i=1}^J e^{z_i}} \\
\end{aligned}
\tag{3}\]</span></span></p>
</div>
</div>
</div>
<p>Vi har indtil videre skrevet, at outputværdierne kan fortolkes som sandsynligheder. Men bare fordi at en række tal (<span class="math inline">\(o_1, o_2, \dots, o_J\)</span>) alle ligger mellem 0 og 1 og alle summerer til 1, så er det jo ikke sikkert, at de på en fornuftig måde angiver sandsynligheden for de fire forskellige muligheder, som de enkelte elever har. For eksempel kunne de fleste lærere nok ønske sig, at</p>
<p><span class="math display">\[
o_1 = 0.5, \quad 0_2 = 0.5, \quad o_3=0, \quad o_4=0
\]</span> fuldstændig uafhængig af svarene på de tre spørgsmål.</p>
<p>Det svarer til, at cirka halvdelen af elever bliver i klassen og regner opgaver, mens den anden halvdel sætter sig ud og regner. Til gengæld er der <em>ingen</em>, som går i kantinen og feder den, ligsom der heller ikke er nogle, som bare går hjem.</p>
<p>For at vores nye AI assistent skal give et nogenlunde retvisende billede af virkeligheden (det vil sige elevernes valg og ikke lærerens ønsker!) skal vi have fundet nogle outputværdier, som for det første afhænger af inputværdierne (man kan jo se på <a href="#fig-trainingdata" class="quarto-xref">figur&nbsp;1</a> at inputværdierne har indflydelse), og som for det andet rent faktisk giver en realistisk sandsynlighed for hver af de fire muligheder. Det gør vi ved at blive ved med at "skrue" på alle vægtene indtil, at de beregnede outputværdier i (<a href="#eq-o_j" class="quarto-xref">3</a>) giver et godt bud på sandsynlighederne for de 4 muligheder.</p>
<p>Hvordan, det rent faktisk lader sig gøre, kommer her.</p>
</section>
<section id="cross-entropy-tabsfunktionen" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="cross-entropy-tabsfunktionen">Cross-entropy tabsfunktionen</h2>
<p>Forestil dig at vi bare har valgt nogle tilfældige værdier af vægtene. På den baggrund kan vi for et givent sæt af inputværdier beregne outputværdierne ved hjælp af feedforward-udtrykkene i (<a href="#eq-o_j" class="quarto-xref">3</a>). Vi vil som eksempel se på elev nummer 7 fra <a href="#tbl-trainingdata" class="quarto-xref">tabel&nbsp;1</a>. Denne elev har valgt mulighed 2 (gå uden for klassen for at regne opgaver) og har derfor targetværdi</p>
<p><span id="eq-target"><span class="math display">\[
\vec t =
\begin{pmatrix}
0 \\
1 \\
0 \\
0 \\
\end{pmatrix}
\tag{4}\]</span></span></p>
<p>En bestemt "indstilling" af vægtene kunne for eksempel give denne outputvektor:</p>
<p><span id="eq-o_bad"><span class="math display">\[
\vec o =
\begin{pmatrix}
0.85 \\
0.10 \\
0.03 \\
0.02 \\
\end{pmatrix}
\tag{5}\]</span></span></p>
<p>Det svarer til at vægtene ikke har fået nogle "gode" værdier, fordi denne outputvektor svarer til, at der kun er <span class="math inline">\(10 \%\)</span> chance for at eleven vælger mulighed 2. Hvis vægtene i stedet havde haft værdier, som ville resultere i denne outputvektor</p>
<p><span id="eq-o_good"><span class="math display">\[
\vec o =
\begin{pmatrix}
0.10 \\
0.85 \\
0.03 \\
0.02 \\
\end{pmatrix}
\tag{6}\]</span></span></p>
<p>så vil vi straks være mere tilfredse med vores AI assistent, fordi sandsynligheden for mulighed 2 nu er steget til <span class="math inline">\(85 \%\)</span>. Faktisk vil vi allerhelst kunne vælge vægtene, så outputvektoren for elev nummer 7 kommer så tæt som muligt på targetvektoren i (<a href="#eq-target" class="quarto-xref">4</a>) – og noget tilsvarende skal gerne gøre sig gældende for de øvrige 11 elever i træningsdata.</p>
<p>Vi har derfor brug for en metode til at vælge vægtene, så outputvektoren i (<a href="#eq-o_good" class="quarto-xref">6</a>) bliver "belønnet" fremfor outputvektoren i (<a href="#eq-o_bad" class="quarto-xref">5</a>). For at gøre det definerer man en såkaldt <strong>tabsfunktion</strong>. Vi vil her bruge en tabsfunktion, som kaldes for <strong>cross-entropy</strong>.</p>
<p>For at holde tingene simple starter vi med at se på ét træningseksempel ad gangen (til sidst generaliserer vi). <em>Cross-entropy</em> tabsfunktionen er defineret sådan her:</p>
<p><span class="math display">\[
E = - \sum_{j=1}^J t_j \cdot \ln(o_j)
\]</span></p>
<p>Det ser måske lige lidt mærkeligt ud, men vi skal nok forklare det. Vi kan prøve at skrive summen ud:</p>
<p><span class="math display">\[
E = - \left (t_1 \cdot \ln(o_1)  + t_2 \cdot \ln(o_2) + \cdots + t_j \cdot \ln(o_j) + \cdots + t_J \cdot \ln(o_J) \right)
\]</span></p>
<p>Vi husker nu på, at <span class="math inline">\(\vec t\)</span> er en <em>one hot vektor</em>. Det vil sige, at det kun er ét af <span class="math inline">\(t_j\)</span>’erne i ovenstående, der er 1 – resten er 0. Lad os sige at det er <span class="math inline">\(t_j\)</span>, der er 1. Så er</p>
<p><span class="math display">\[
E = - t_j \cdot \ln(o_j) = - \ln(o_j).
\]</span></p>
<p>I <a href="#fig-natural_ln" class="quarto-xref">figur&nbsp;5</a> har vi tegnet grafen for den naturlige logaritme-funktion samt grafen for minus den naturlige logartime-funktion:</p>
<div id="fig-natural_ln" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-natural_ln-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/natural_ln.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-natural_ln-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figur&nbsp;5: Grafen for <span class="math inline">\(\ln(x)\)</span> og <span class="math inline">\(-\ln(x)\)</span>.
</figcaption>
</figure>
</div>
<p>Da <span class="math inline">\(0&lt;o_j&lt;1\)</span> kan vi for det første se, at <span class="math inline">\(-\ln(o_j) &gt;0\)</span>. Det vil sige, at tabsfunktionen er positiv.</p>
<p>Husk nu på at <span class="math inline">\(t_j=1\)</span>. Hvis vægtene i vores neurale netværk er "indstillet" godt, så skal <span class="math inline">\(o_j\)</span> være tæt på 1. I <a href="#fig-natural_ln" class="quarto-xref">figur&nbsp;5</a> kan vi se, at det svarer til, at <span class="math inline">\(-\ln(o_j)\)</span> er tæt på <span class="math inline">\(0\)</span>. Det betyder, at værdien af tabsfunktionen er lille. Omvendt hvis vægtene er "indstillet" dårligt, så <span class="math inline">\(o_j\)</span> er tæt på <span class="math inline">\(0\)</span> (selvom <span class="math inline">\(t_j=1\)</span>), så vil <span class="math inline">\(-\ln(o_j)\)</span> være et stort positivt tal. Altså er værdien af tabsfunktionen stor.</p>
<p>Det betyder, at tabsfunktionen på den måde måler "kvaliteten" af netværket:</p>
<ul>
<li><p>For et godt netværk (med gode indstillinger af vægtene) vil tabsfunktionen have en lille, men positiv værdi.</p></li>
<li><p>For et dårligt netværk (med dårlige indstillinger af vægtene) vil tabsfunktionen have en stor positiv værdi.</p></li>
</ul>
<p>Lad også illustrere det med det tidligere eksempel. Hvis</p>
<p><span class="math display">\[
\vec t =
\begin{pmatrix}
0 \\
1 \\
0 \\
0 \\
\end{pmatrix}
\quad \textrm{og} \quad
\vec o =
\begin{pmatrix}
0.85 \\
0.10 \\
0.03 \\
0.02 \\
\end{pmatrix}
\]</span></p>
<p>så har vi et dårligt netværk og værdien af tabsfunktionen bliver</p>
<p><span class="math display">\[
\begin{aligned}
E &amp;= - \left( 0 \cdot \ln(0.85) + 1 \cdot \ln(0.10) + 0 \cdot \ln(0.03) + 0 \cdot \ln(0.02)\right) \\ &amp;= - \ln(0.10) \approx 2.30.
\end{aligned}
\]</span></p>
<p>Har vi derimod et bedre netværk, som i stedet giver følgende outputvektor:</p>
<p><span class="math display">\[
\vec t =
\begin{pmatrix}
0 \\
1 \\
0 \\
0 \\
\end{pmatrix}
\quad \textrm{og} \quad
\vec o =
\begin{pmatrix}
0.10 \\
0.85 \\
0.03 \\
0.02 \\
\end{pmatrix}
\]</span></p>
<p>så vil værdien af tabsfunktionen være</p>
<p><span class="math display">\[
\begin{aligned}
E &amp;= - \left( 0 \cdot \ln(0.10) + 1 \cdot \ln(0.85) + 0 \cdot \ln(0.03) + 0 \cdot \ln(0.02)\right) \\
&amp;= - \ln(0.85) \approx 0.16.
\end{aligned}
\]</span></p>
<p>Altså kan vi her se, at det netværk, som er bedre, også har en lavere værdi af tabsfunktionen. Hele idéen er derfor, at vi for et givent træningsdatasæt vil bestemme de værdier af vægtene, som minimerer tabsfunktionen. Hvordan det gøres forklares i det næste afsnit.</p>
</section>
<section id="opdatering-af-vægtene" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="opdatering-af-vægtene">Opdatering af vægtene</h2>
<p>Vi skal bestemme de værdier af vægtene, som minimerer tabsfunktionen</p>
<p><span id="eq-cross_entropy"><span class="math display">\[
E = - \sum_{i=1}^J t_i \cdot \ln(o_i)
\tag{7}\]</span></span></p>
<p>Husk på at outputværdierne <span class="math inline">\(o_i\)</span> afhænger af <span class="math inline">\(z\)</span>-værdierne via (<a href="#eq-o_j" class="quarto-xref">3</a>), mens <span class="math inline">\(z\)</span>-værdierne afhænger af vægtene via (<a href="#eq-z_j" class="quarto-xref">2</a>). Altså afhænger tabsfunktionen også indirekte af alle vægtene.</p>
<p>Når man skal minimere <a href="../../materialer/funktioner_af_flere_variable/funktioner_af_flere_variable.html">en funktion, som afhænger af flere variable</a> (her vægtene), kan man finde alle de partielle afledede og sætte dem lig med <span class="math inline">\(0\)</span> (ligesom du sikkert er vant til, at løse <span class="math inline">\(f'(x)=0\)</span>, hvis du skal bestemme minimum for funktionen <span class="math inline">\(f\)</span>). Det vil give lige så mange ligninger, som der er vægte, og desuden vil ligningerne være koblet med hinanden. Det betyder, at denne fremgangsmåde er beregningsmæssig tung og/eller vil kræve alt for meget plads på en computer. Derfor vælger man i stedet at bruge en approksimativ metode, som kaldes for <a href="../../materialer/gradientnedstigning/gradientnedstigning.html">gradientnedstigning</a>. Vi vil her kort forklare, hvad det går ud på.</p>
<p>Hvis en funktion <span class="math inline">\(f\)</span> afhænger af <span class="math inline">\(x_1, x_2, \dots, x_n\)</span> så kaldes den vektor, som består af alle de partielle afledede for gradienten:</p>
<p><span class="math display">\[
\nabla f(x_1, x_2, \dots, x_n) =
\begin{pmatrix}
\frac{\partial f}{\partial x_1} \\
\frac{\partial f}{\partial x_2} \\
\vdots \\
\frac{\partial f}{\partial x_n}
\end{pmatrix}.
\]</span></p>
<p>Det viser sig, at denne gradient peger i den retning, hvor funktionsværdien <em>vokser mest</em>. Omvendt vil minus gradienten <span class="math inline">\(-\nabla f(x_1, x_2, \dots, x_n)\)</span> pege i den retning, hvor funktionsværdien <em>aftager mest</em>. Hvis vi derfor står et vilkårligt sted på grafen for <span class="math inline">\(f\)</span> og går et lille skridt i den negative gradientens retning, så vil vi være på vej ned mod et minimum (eventuelt kun lokalt). Når vi har gået det lille skridt, udregner vi gradienten igen og bevæger os igen et lille skridt i den negative gradients retning<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Sådan fortsætter man indstil funktionsværdien ikke ændrer sig ret meget – det svarer forhåbentlig til, at vi har fundet et (lokalt) minimum.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;Du kan tænke på gradienten som et kompas, der hele tiden viser dig, hvilken vej du skal gå for at bevæge dig ned mod et minimum.</p></div></div><p>Nu hedder vores funktion ikke <span class="math inline">\(f\)</span>, men <span class="math inline">\(E\)</span>, og <span class="math inline">\(E\)</span> afhænger af alle vægtene <span class="math inline">\(w_{j,k}\)</span>. Derfor, når vægten <span class="math inline">\(w_{j,k}\)</span> skal opdateres, så gør vi følgende:</p>
<p><span id="eq-w_jk-opdatering_grad"><span class="math display">\[
w_{j,k}^{\textrm{ny}} \leftarrow w_{j,k} - \eta \cdot \frac{\partial E}{\partial w_{j,k}}.
\tag{8}\]</span></span></p>
<p>Tallet <span class="math inline">\(\eta\)</span> kaldes for en <strong>learning rate</strong> og er typisk et lille tal mellem <span class="math inline">\(0\)</span> og <span class="math inline">\(1\)</span>. Det svarer til den skridtlængde vi bruger, når vi går i den negative gradients retning.</p>
<p>Det vil sige for at opdatere <span class="math inline">\(w_{j,k}\)</span>-vægten, skal vi have udregnet den partielle afledede</p>
<p><span class="math display">\[
\frac{\partial E}{\partial w_{j,k}}.
\]</span></p>
<p>Hvis vi ser på <a href="#fig-netvaerk_generelt_wjk" class="quarto-xref">figur&nbsp;6</a> og (<a href="#eq-z_j" class="quarto-xref">2</a>) kan vi se, at <span class="math inline">\(w_{j,k}\)</span> kun har indflydelse på <span class="math inline">\(z_j\)</span>. Til gengæld har alle <span class="math inline">\(z\)</span>-værdierne indflydelse på alle <span class="math inline">\(o\)</span>-værdierne på grund af udtrykket i (<a href="#eq-o_j" class="quarto-xref">3</a>).</p>
<div id="fig-netvaerk_generelt_wjk" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-netvaerk_generelt_wjk-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/netvaerk_generelt_wjk.png" class="img-fluid figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-netvaerk_generelt_wjk-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figur&nbsp;6: Neuralt netværk hvor vægtene fra de <span class="math inline">\(n\)</span> input neuroner over til den <span class="math inline">\(i\)</span>’te output neuron er vist.
</figcaption>
</figure>
</div>
<p>Derfor kan vi ved hjælp af kædereglen for flere variable finde den partielle afledede af <span class="math inline">\(E\)</span> med hensyn til <span class="math inline">\(w_{j,k}\)</span> på denne måde</p>
<p><span class="math display">\[
\frac{\partial E}{\partial w_{j,k}} = \sum_{i=1}^J \frac{\partial E}{\partial z_i} \cdot \frac{\partial z_i}{\partial w_{j,k}}
\]</span></p>
<p>Men da <span class="math inline">\(w_{j,k}\)</span> kun har indflydelse på <span class="math inline">\(z_j\)</span> (jævnfør <a href="#fig-netvaerk_generelt_wjk" class="quarto-xref">figur&nbsp;6</a> og (<a href="#eq-z_j" class="quarto-xref">2</a>)), så vil</p>
<p><span class="math display">\[
\frac{\partial z_i}{\partial w_{j,k}}=0 \qquad \text{når} \qquad i \neq j
\]</span></p>
<p>og derfor kan vi nøjes med følgende forsimplede udtryk:</p>
<p><span id="eq-partialE_w_jk"><span class="math display">\[
\frac{\partial E}{\partial w_{j,k}} = \frac{\partial E}{\partial z_j} \cdot \frac{\partial z_j}{\partial w_{j,k}}
\tag{9}\]</span></span></p>
<p>Vi starter med at regne på den sidste faktor <span class="math inline">\(\frac{\partial z_j}{\partial w_{j,k}}\)</span> (fordi den er nemmeste!). Ifølge (<a href="#eq-z_j" class="quarto-xref">2</a>) er</p>
<p><span id="eq-partial_z_j_w_jk"><span class="math display">\[
\begin{aligned}
\frac{\partial z_j}{\partial w_{j,k}} &amp;= \frac{\partial }{\partial w_{j,k}} \left ( w_{j,0} + w_{j,1} \cdot x_1 + w_{j,2} \cdot x_2 + \cdots +  w_{j,k} \cdot x_k + \cdots +  w_{j,n} \cdot x_n \right) \\
&amp;= x_k
\end{aligned}
\tag{10}\]</span></span></p>
<p>For at bestemme den første faktor <span class="math inline">\(\frac{\partial E}{\partial z_j}\)</span> bruger vi definitionen af tabsfunktionen i (<a href="#eq-cross_entropy" class="quarto-xref">7</a>) og differentierer ledvist:</p>
<p><span id="eq-partialE_z_j"><span class="math display">\[
\frac{\partial E}{\partial z_j} = - \sum_{i=1}^J t_i \cdot \frac{1}{o_i} \cdot \frac{\partial o_i}{\partial z_j},
\tag{11}\]</span></span></p>
<p>hvor vi har brugt, at <span class="math inline">\(\ln(o_i)\)</span> differentieret er <span class="math inline">\(\frac{1}{o_i}\)</span>.</p>
<p>Nu er</p>
<p><span class="math display">\[
o_i = \frac{e^{z_i}}{\sum_{l=1}^J e^{z_l}}.
\]</span></p>
<p>Da <span class="math inline">\(o_i\)</span> er udtrykt ved en brøk, får vi brug for kvotientreglen, når vi skal differentiere <span class="math inline">\(o_i\)</span>:</p>
<p><span class="math display">\[
\left ( \frac{f}{g} \right )'(x)= \frac{f'(x)  \cdot g(x) - f(x) \cdot g'(x)}{(g(x))^2}
\]</span></p>
<p>Når <span class="math inline">\(o_i\)</span> skal differentieres med hensyn til <span class="math inline">\(z_j\)</span>, er der to muligheder alt efter om <span class="math inline">\(i=j\)</span> eller <span class="math inline">\(i \neq j\)</span>.</p>
<p>Hvis <span class="math inline">\(i \neq j\)</span>, får vi</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial o_i}{\partial z_j} &amp;= \frac{0 \cdot (\sum_{l=1}^J e^{z_l}) - e^{z_i} \cdot e^{z_j}}{\left ( \sum_{l=1}^J e^{z_l} \right )^2} \\
&amp;= - \frac{e^{z_i}}{\sum_{l=1}^J e^{z_l}} \cdot \frac{e^{z_j}}{\sum_{l=1}^J e^{z_l}} = - o_i \cdot o_j, \quad \quad i \neq j
\end{aligned}
\]</span></p>
<p>hvor sidste lighedstegn følger af definitionen i (<a href="#eq-o_j" class="quarto-xref">3</a>).</p>
<p>Hvis <span class="math inline">\(i=j\)</span>, får vi</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial o_i}{\partial z_j} &amp;= \frac{\partial o_j}{\partial z_j} = \frac{e^{z_j} \cdot (\sum_{l=1}^J e^{z_l}) - e^{z_j} \cdot e^{z_j}}{\left ( \sum_{l=1}^J e^{z_l} \right )^2} \\
&amp;= \frac{e^{z_j} \cdot (\sum_{l=1}^J e^{z_l})}{\left ( \sum_{l=1}^J e^{z_l} \right )^2} - \frac{(e^{z_j})^2}{\left ( \sum_{l=1}^J e^{z_l} \right )^2} \\
&amp;= \frac{e^{z_j}}{\sum_{l=1}^J e^{z_l}} - \left ( \frac{e^{z_j}}{\sum_{l=1}^J e^{z_l}} \right)^2 \\
&amp; = o_j-o_j^2 = o_j(1-o_j), \quad \quad i = j
\end{aligned}
\]</span></p>
<p>Vi kan nu indsætte i (<a href="#eq-partialE_z_j" class="quarto-xref">11</a>):</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial E}{\partial z_j} &amp;= - \left ( \sum_{\substack{i=1 \\ i \neq j }}^J t_i \cdot \frac{1}{o_i} \cdot (-o_i \cdot o_j) \right ) - t_j \cdot \frac{1}{o_j} \cdot o_j \cdot (1-o_j) \\
&amp;=  - \left ( \sum_{\substack{i=1 \\ i \neq j }}^J t_i \cdot (-o_j) \right ) - t_j \cdot (1-o_j) \\
&amp;=  \left ( \sum_{\substack{i=1 \\ i \neq j }}^J t_i \cdot o_j \right ) - t_j + t_j \cdot o_j
\end{aligned}
\]</span></p>
<p>Vi kan nu se, at det led <span class="math inline">\(t_j \cdot o_j\)</span>, som ikke er med i den første sum (hvor <span class="math inline">\(i \neq j\)</span>), fremkommer som sidste led i ovenstående udtryk. Derfor kan vi inkludere dette led i den første sum og få:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial E}{\partial z_j} &amp;= \left (\sum_{i=1}^J t_i \cdot o_j  \right ) - t_j \\
&amp; =  \left (o_j \cdot  \sum_{i=1}^J t_i  \right ) - t_j,
\end{aligned}
\]</span></p>
<p>hvor sidste lighedstegn følger af, at <span class="math inline">\(o_j\)</span> ikke afhænger af det indeks, vi summerer over, og derfor kan <span class="math inline">\(o_j\)</span> sættes ud foran summen (det svarer til at sætte en fællesfaktor ud foran en parentes).</p>
<p>Vi udnytter nu, at <span class="math inline">\(\vec t\)</span> er en <em>one hot vektor</em> – det vil sige, at <span class="math inline">\(\sum_{i=1}^J t_i = 1\)</span>. Derfor ender vi med det meget simple udtryk</p>
<p><span class="math display">\[
\frac{\partial E}{\partial z_j} = o_j - t_j = -(t_j-o_j)
\]</span></p>
<p>Vi indsætter i (<a href="#eq-partialE_w_jk" class="quarto-xref">9</a>) og får</p>
<p><span id="eq-partialE_partial_wjk_final"><span class="math display">\[
\frac{\partial E}{\partial w_{j,k}} = \underbrace{-(t_j - o_j)}_{\frac{\partial E}{\partial z_j}} \cdot \underbrace{x_k}_{\frac{\partial z_j}{\partial w_{j,k}}}
\tag{12}\]</span></span></p>
<p>Bruger vi opdateringsreglen for <span class="math inline">\(w_{j,k}\)</span>-vægten i (<a href="#eq-w_jk-opdatering_grad" class="quarto-xref">8</a>), ender vi med følgende:</p>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Opdateringsregel for <span class="math inline">\(w_{i,k}\)</span>-vægten (baseret på ét træningseksempel)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Vægten fra det <span class="math inline">\(k\)</span>’te input <span class="math inline">\(x_k\)</span> til den <span class="math inline">\(j\)</span>’te outputneuron opdateres således:</p>
<p><span class="math display">\[
w_{j,k}^{(\textrm{ny})} \leftarrow w_{j,k} + \eta \cdot (t_j - o_j) \cdot x_k
\]</span></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/netvaerk_generelt_wjk_zoom.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<section id="opdatering-ved-hjælp-af-hele-træningsdatasættet" class="level3">
<h3 class="anchored" data-anchor-id="opdatering-ved-hjælp-af-hele-træningsdatasættet">Opdatering ved hjælp af hele træningsdatasættet</h3>
<p>I det ovenstående har vi udledt opdateringsreglen for <span class="math inline">\(w_{j,k}\)</span>-vægten baseret ét enkelt træningseksempel ad gangen ved at finde minimum for tabsfunktionen:</p>
<p><span class="math display">\[
E = - \sum_{i=1}^J t_i \cdot \ln(o_i)
\]</span></p>
<p>I virkeligheden definerer man tabsfunktionen baseret på hele træningsdatasættet. Vi starter med at nummerere træningsdata fra <span class="math inline">\(1\)</span> til <span class="math inline">\(M\)</span> og kalder targetværdien og outputværdien hørende til det <span class="math inline">\(m\)</span>’te træningseksempel for <span class="math inline">\(\vec t^{(m)}\)</span> og <span class="math inline">\(\vec o^{(m)}\)</span>:</p>
<p><span class="math display">\[
\vec t^{(m)} =
\begin{pmatrix}
t_1^{(m)} \\
t_2^{(m)} \\
\vdots \\
t_J^{(m)} \\
\end{pmatrix} \quad \quad \textrm{og} \quad \quad
\vec o^{(m)} =
\begin{pmatrix}
o_1^{(m)} \\
o_2^{(m)} \\
\vdots \\
o_J^{(m)} \\
\end{pmatrix}
\]</span></p>
<p>Så definerer man tabsfunktionen på denne måde:</p>
<p><span class="math display">\[
E = \sum_{m=1}^M \left (- \sum_{i=1}^J t_i^{(m)} \cdot \ln(o_i^{(m)}) \right )
\]</span> Og sætter vi</p>
<p><span class="math display">\[
E^{(m)} = - \sum_{i=1}^J t_i^{(m)} \cdot \ln(o_i^{(m)})
\]</span> så bliver tabsfunktionen bare en sum over de individuelle bidrag til tabsfunktionen fra hvert træningseksempel:</p>
<p><span class="math display">\[
E = \sum_{m=1}^M E^{(m)}
\]</span> Vi kan heldigvis differentiere ledvist og får derfor</p>
<p><span class="math display">\[
\frac{\partial E}{\partial w_{j,k}} = \sum_{m=1}^M \frac{\partial E^{(m)}}{\partial w_{j,k}}
\]</span> I det foregående afsnit var det netop <span class="math inline">\(\frac{\partial E^{(m)}}{\partial w_{j,k}}\)</span> vi udledte i (<a href="#eq-partialE_partial_wjk_final" class="quarto-xref">12</a>) – dog uden at specificere nummeret på træningseksemplet:</p>
<p><span class="math display">\[
\frac{\partial E^{(m)}}{\partial w_{j,k}} = -(t_j^{(m)} - o_j^{(m)}) \cdot x_k^{(m)}
\]</span></p>
<p>Derfor bliver <span class="math display">\[
\frac{\partial E}{\partial w_{j,k}} = \sum_{m=1}^M \frac{\partial E^{(m)}}{\partial w_{j,k}} = - \sum_{m=1}^M (t_j^{(m)} - o_j^{(m)}) \cdot x_k^{(m)}
\]</span> Opdateringsreglen for <span class="math inline">\(w_{j,k}\)</span>-vægten bliver i det tilfælde:</p>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Opdateringsregel for <span class="math inline">\(w_{i,k}\)</span>-vægten (baseret på hele træningsdatasættet)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Vægten fra det <span class="math inline">\(k\)</span>’te input <span class="math inline">\(x_k\)</span> til den <span class="math inline">\(j\)</span>’te outputneuron opdateres således:</p>
<p><span class="math display">\[
w_{j,k}^{(\textrm{ny})} \leftarrow w_{j,k} + \eta \cdot \sum_{m=1}^M (t_j^{(m)} - o_j^{(m)}) \cdot x_k^{(m)}
\]</span></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/netvaerk_generelt_wjk_zoom.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<p>Samlet set trænes netværket på denne måde:</p>
<ol type="1">
<li><p>Sæt alle vægtene til en tilfældig værdi og vælg en værdi for learning raten <span class="math inline">\(\eta\)</span>.</p></li>
<li><p>For alle træningseksempler udregnes <span class="math inline">\(z_j^{(m)}\)</span> og <span class="math inline">\(o_j^{(m)}\)</span> ved hjælp af feedforward-udtrykkene:</p>
<p><span class="math display">\[
z_j^{(m)} = w_{j,0} + w_{j,1} \cdot x_1^{(m)} + w_{j,2} \cdot x_2^{(m)} + \cdots + w_{j,n} \cdot x_n^{(m)}
\]</span></p>
<p>og</p>
<p><span class="math display">\[
o_j^{(m)} = \frac{e^{z_j^{(m)}}}{\sum_{i=1}^J e^{z_i^{(m)}}}
\]</span></p>
<p>for <span class="math inline">\(j=1, 2, \dots, J\)</span>.</p></li>
<li><p>Opdatér alle vægtene:</p>
<p><span class="math display">\[
w_{j,k}^{(\textrm{ny})} \leftarrow w_{j,k} + \eta \cdot \sum_{m=1}^M (t_j^{(m)} -    o_j^{(m)}) \cdot x_k^{(m)}
\]</span></p></li>
</ol>
<p>Alle vægtene er nu opdateret, og vi kan gentage punkt 2 og 3, hvor feedforward i 2 hver gang er baseret på de netop opdaterede vægte fra det foregående gennemløb. Opdateringen af vægtene fortsætter indtil værdien af tabsfunktionen næsten ikke ændrer sig. Håbet er nu, at vi har fundet et minimum (eventuelt kun lokalt) for tabsfunktionen.</p>
</section>
</section>
<section id="tilbage-til-eksemplet" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="tilbage-til-eksemplet">Tilbage til eksemplet</h2>
<p>Vi har nu fået udledt opdateringsreglerne for alle vægtene, og vi vil derfor prøve at træne et netværk ved hjælp af træningsdata i <a href="#tbl-trainingdata" class="quarto-xref">tabel&nbsp;1</a>. Hvis vi til start sætter alle vægtene til <span class="math inline">\(0.5\)</span>, vælger en learning rate på <span class="math inline">\(0.001\)</span> og laver i alt <span class="math inline">\(100000\)</span> iterationer (det vil sige, at vægtene alt i alt opdateres <span class="math inline">\(100000\)</span> gange), så nærmer vi os et minimum for tabsfunktionen. Alle outputværdierne kan nu beregnes ved hjælp af (<a href="#eq-o_j" class="quarto-xref">3</a>). Gør vi det for alle data i træningsdatasættet, får vi følgende<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>:</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;Bemærk, at hvis <span class="math inline">\(o_1+o_2+o_3+ o_4\)</span> ikke giver <span class="math inline">\(1\)</span>, så skyldes det afrunding.</p></div></div><div id="tbl-prediction" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-tbl figure page-columns page-full">
<div aria-describedby="tbl-prediction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Elev nr.</th>
<th style="text-align: center;"><span class="math inline">\(x_1\)</span> (søvn)</th>
<th style="text-align: center;"><span class="math inline">\(x_2\)</span> (emne)</th>
<th style="text-align: center;"><span class="math inline">\(x_3\)</span> (eksamen)</th>
<th style="text-align: center;">Valg</th>
<th style="text-align: center;"><span class="math inline">\(o_1\)</span></th>
<th style="text-align: center;"><span class="math inline">\(o_2\)</span></th>
<th style="text-align: center;"><span class="math inline">\(o_3\)</span></th>
<th style="text-align: center;"><span class="math inline">\(o_4\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(1\)</span></td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#020873} 1}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.98\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.02\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(8\)</span></td>
<td style="text-align: center;"><span class="math inline">\(7\)</span></td>
<td style="text-align: center;"><span class="math inline">\(8\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#020873} 1}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.50\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.50\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(3\)</span></td>
<td style="text-align: center;"><span class="math inline">\(9\)</span></td>
<td style="text-align: center;"><span class="math inline">\(6\)</span></td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#020873} 1}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.76\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.23\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(4\)</span></td>
<td style="text-align: center;"><span class="math inline">\(4\)</span></td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#020873} 1}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.77\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.23\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(5\)</span></td>
<td style="text-align: center;"><span class="math inline">\(5\)</span></td>
<td style="text-align: center;"><span class="math inline">\(8\)</span></td>
<td style="text-align: center;"><span class="math inline">\(7\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#8086F2} 2}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.19\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.81\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(6\)</span></td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\(7\)</span></td>
<td style="text-align: center;"><span class="math inline">\(4\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#8086F2} 2}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.15\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.85\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(7\)</span></td>
<td style="text-align: center;"><span class="math inline">\(7\)</span></td>
<td style="text-align: center;"><span class="math inline">\(7\)</span></td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#8086F2} 2}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.70\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.30\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(8\)</span></td>
<td style="text-align: center;"><span class="math inline">\(8\)</span></td>
<td style="text-align: center;"><span class="math inline">\(3\)</span></td>
<td style="text-align: center;"><span class="math inline">\(4\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#F2B33D} 3}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.98\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.02\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(9\)</span></td>
<td style="text-align: center;"><span class="math inline">\(6\)</span></td>
<td style="text-align: center;"><span class="math inline">\(2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(5\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#F2B33D} 3}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.99\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.01\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\(2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(2\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#F2B33D} 3}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(1.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(11\)</span></td>
<td style="text-align: center;"><span class="math inline">\(1\)</span></td>
<td style="text-align: center;"><span class="math inline">\(1\)</span></td>
<td style="text-align: center;"><span class="math inline">\(3\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#F288B9} 4}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.02\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.98\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(12\)</span></td>
<td style="text-align: center;"><span class="math inline">\(5\)</span></td>
<td style="text-align: center;"><span class="math inline">\(2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(2\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#F288B9} 4}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.02\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.02\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.96\)</span></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-tbl margin-caption" id="tbl-prediction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Tabel&nbsp;2: Træningsdata fra 12 elever inklusion de bergende outputværdier.
</figcaption>
</figure>
</div>
<p>Et netværk vil altid være forholdsvis godt til at prædiktere korrekt på de data, som netværket er trænet på. Det kan du læse mere om i noten om <a href="../../materialer/krydsvalidering/krydsvalidering.html">Overfitting, modeludvælgelse og krydsvalidering</a>. Med det i baghovedet kan vi alligevel se fra <a href="#tbl-prediction" class="quarto-xref">tabel&nbsp;2</a> se, at den prædikterede sandsynlighed for det valg, som hver elev træffer, er høj. For eksempel vælger elev nr. 1 også valg 1 (at blive i klassen), og den prædikterede sandsynlighed for dette valg er <span class="math inline">\(o_1 = 0.98\)</span>.</p>
<p>For elev nr. 2 kan vi se, at vores AI assistent er i tvivl om (<span class="math inline">\(o_1=o_2=0.50\)</span>), om den skal anbefale valg 1 eller 2 (eleven har valgt 1). For elev nr. 7 vil vores AI assisten anbefale valg 1 (<span class="math inline">\(o_1 = 0.70\)</span>), men eleven træffer i virkeligheden valg 2. De resterende anbefalinger er korrekte.</p>
<p>På <a href="#fig-trainingdata_prediction_wrong" class="quarto-xref">figur&nbsp;7</a> er elev 2 og 7 fremhævet ved, at de tilhørende punkter er tegnet større. Hvis man drejer lidt rundt på figuren, kan man se, at de to punkter ligger forholdsvis tæt på hinanden og i nærheden af andre mørkeblå punkter, så det er ikke helt så underligt, at netværket netop har svært ved at prædiktere, som det gør.</p>
<div id="fig-trainingdata_prediction_wrong" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-trainingdata_prediction_wrong-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ggbApplet_trainingdata_prediction_wrong">

</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-trainingdata_prediction_wrong-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figur&nbsp;7: Punktplot af træningsdata fra <a href="#tbl-prediction" class="quarto-xref">tabel&nbsp;2</a>. Punkternes farve angiver valget (mørkeblå svarer til 1, lyseblå svarer til 2, gul svarer til 3 og lyserød svarer til 4). De to punkter, som er tegnet større, svarer til elev 2 og 7, hvor netværket ikke prædikterer korrekt.
</figcaption>
</figure>
</div>
<p>Nu er idéen jo ikke at komme med et godt råd til de elever, som allerede har truffet et valg (svarende til at prædiktere på træningsdata), men derimod at vejlede kommende elever.</p>
<p>Byd derfor velkommen til tre nye elever:</p>
<ul>
<li><p>Den første elev, som træder ind ad døren er Anton. Anton har sovet fuldstændig fantastisk (<span class="math inline">\(x_1=10\)</span>), han synes, at det emne, vi er i gang med, er pænt kedeligt (<span class="math inline">\(x_2=2\)</span>). Til gengæld har Anton høje ambitioner om at klare sig godt til eksamen (<span class="math inline">\(x_3=9\)</span>).</p></li>
<li><p>Herefter følger Signe. Signe bøvler lidt med sin søvn (<span class="math inline">\(x_1=4\)</span>), hun synes, at emnet vi er i gang med er semi godt <span class="math inline">\(x_2=5\)</span>, og så har Signe skyhøje forventninger til eksamen (<span class="math inline">\(x_3=10\)</span>).</p></li>
<li><p>Til sidst kommer Mads – lidt for sent i øvrigt… Mads har nemlig spillet computer den halve nat (<span class="math inline">\(x_1=3\)</span>), han synes, at emnet er ret interessant (<span class="math inline">\(x_2=8\)</span>), men han er pænt ligeglad med, hvordan det går til eksamen (<span class="math inline">\(x_3=2\)</span>).</p></li>
</ul>
<p>Alle tre elever hiver straks deres ny AI assistent op af lommen, indtaster svaret på de tre spørgsmål og beder om en anbefaling. Her er, hvad der kommer ud af det:</p>
<table class="table">
<colgroup>
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Elev</th>
<th style="text-align: center;"><span class="math inline">\(x_1\)</span></th>
<th style="text-align: center;"><span class="math inline">\(x_2\)</span></th>
<th style="text-align: center;"><span class="math inline">\(x_3\)</span></th>
<th style="text-align: center;"><span class="math inline">\(o_1\)</span></th>
<th style="text-align: center;"><span class="math inline">\(o_2\)</span></th>
<th style="text-align: center;"><span class="math inline">\(o_3\)</span></th>
<th style="text-align: center;"><span class="math inline">\(o_4\)</span></th>
<th style="text-align: center;">Valg</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Anton</td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\(2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(9\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(1.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#F2B33D} 3}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;">Signe</td>
<td style="text-align: center;"><span class="math inline">\(4\)</span></td>
<td style="text-align: center;"><span class="math inline">\(5\)</span></td>
<td style="text-align: center;"><span class="math inline">\(10\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.17\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.82\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#8086F2} 2}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Mads</td>
<td style="text-align: center;"><span class="math inline">\(3\)</span></td>
<td style="text-align: center;"><span class="math inline">\(8\)</span></td>
<td style="text-align: center;"><span class="math inline">\(2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(1.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.00\)</span></td>
<td style="text-align: center;"><span class="math inline">\({\color{#8086F2} 2}\)</span></td>
</tr>
</tbody>
</table>
<p>Anton bliver anbefalet, at gå i kantinen (valg 3), mens Signe og Mads bliver anbefalet at gå ud for at regne opgaver (valg 2). Det kan godt se ud som om, at <span class="math inline">\(x_2\)</span> (interessen for emnet) er forholdsvis afgørende for den endelig anbefaling. Hvis du tager et kig på <a href="#fig-trainingdata" class="quarto-xref">figur&nbsp;1</a>, vil du også opdage, at hvis <span class="math inline">\(x_2&lt;5\)</span>, så er alle punkter lyserøde eller gule (svarende til valg 3 og 4), mens alle punkter, hvor <span class="math inline">\(x_2 \geq 5\)</span> er lyse- eller mørkeblå (valg 1 og 2). Det kunne jo få en til at tænke, om det i virkeligheden ville være nok at svare på spørgsmål 2, uden at det går udover klassifikationsnøjagtigheden. Det vil man kunne undersøge ved at lave en model med kun <span class="math inline">\(x_2\)</span> som inputvariabel og en anden model med alle tre inputvariable og så for eksempel vurdere de to modellers klassifikationsnøjagtighed ved hjælp af <a href="../../materialer/krydsvalidering/krydsvalidering.html">krydsvalidering</a>, men det ligger uden for formålet med denne note.</p>
<p>I <a href="#fig-trainingdata_tre_nye_elever" class="quarto-xref">figur&nbsp;8</a> er de tre nye elever indtegnet sammen med træningsdata. Når man ser, hvordan de tre nye elever ligger i forhold til de andre punkter i træningsdata, så giver det faktisk god mening, at Anton bliver "farvet" gul, mens Signe og Mads bliver "farvet" lyseblå.</p>
<div id="fig-trainingdata_tre_nye_elever" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-trainingdata_tre_nye_elever-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="ggbApplet_trainingdata_tre_nye_elever">

</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-trainingdata_tre_nye_elever-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figur&nbsp;8: Punktplot af træningsdata fra <a href="#tbl-trainingdata" class="quarto-xref">tabel&nbsp;1</a>. Punkternes farve angiver valget (mørkeblå svarer til 1, lyseblå svarer til 2, gul svarer til 3 og lyserød svarer til 4). Derudover er de tre nye elever indtegnet (punkterne er farvet grå).
</figcaption>
</figure>
</div>


</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/aimat\.dk");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>