---
title: "Word2Vec"
description-meta: "En øvelse i at lave og forstå beregninger i Word2Vec."
image: "../materialer/sprogmodeller/images/word2vec_simple.png"
categories:
  - A-niveau
  - Kort
---

::: {.callout-caution collapse="true" appearance="minimal"}
### Forudsætninger og tidsforbrug

+ Vektorregning
+ Eksponentialfunktionen.
+ Word2Vec teori.

Forudsætningerne om WordVec teori bør dækkes ved hjælp af [noten om Word2Vec](../materialer/sprogmodeller/word2vec.qmd){target="_blank"}.

**Tidsforbrug:** Ca. 90 minutter.

:::

::: {.purpose}

### Formål

Formålet med dette forløb er dels at gennemføre beregningerne i Word2vec for et meget lille korpus af data, men også at forstå, hvad det vil sige at optimere vektorerne, så tabsfunktionen minimeres.

:::

## Et meget lille tekstkorpus

Vi vi anvende følgende meget simple tekstkorpus med 12 sætninger, som kun anvender 5 forskellige ord. Vi anvender et 1-ords vindue, som vi endda begrænser til kun at indeholde det andet ord på samme linje. Hvis vi tager "Hunden" som fokusord i den første linje, er "sover" derfor det eneste ord i 1-ordsvinduet, og dermed det eneste kontekstord. 

 - Hunden sover.
 - Katten sover.
 - Katten spinder.
 - Hunden gør.
 - Hunden sover.
 - Hunden gør.
 - Katten sover.
 - Hunden gør.
 - Katten sover.
 - Katten spinder.
 - Katten sover.
 - Katten spinder.

Overordnet er ideen så, at vi skal bestemme værdier til fokus- og kontekstvektorer, så værdien af tabfunktionen minimeres.

## Fokus- og kontekstvektorer.

Vi skal således bruge både fokusvektorer og kontekstvektorer.

::: {.callout-note collapse="false" appearance="minimal"}
### Opgave 1: 

 - Hvor mange fokusvektorer er der brug for? 
 - Hvor mange kontekstvektorer er der brug for?

:::

Nu vælger vi indledningsvis værdier til alle disse vektorer - vi venter med optimering.
For at gøre det simplere, vil vi I dette forløb begrænse os til enhedsvektorer, hvor længden i Word2vec ellers generelt er variabel.

Fokusvektorerne:
$$
\vec{v}_{hunden} = \begin{pmatrix} -0,8 \\ 0,6 \end{pmatrix}, \: \\
\vec{v}_{katten} = \begin{pmatrix} 0 \\ 1 \end{pmatrix}, \: \\
\vec{v}_{spinder} = \begin{pmatrix} 0,6 \\ 0,8 \end{pmatrix}, \: \\
\vec{v}_{sover} = \begin{pmatrix} 0,8 \\ 0,6 \end{pmatrix}, \: \\
\vec{v}_{gør} = \begin{pmatrix} 1 \\ 0 \end{pmatrix} \\
$$
Kontekstvektorerne:
$$
\vec{k}_{hunden} = \begin{pmatrix} 0,8 \\ -0,6 \end{pmatrix}, \: \\
\vec{k}_{katten} = \begin{pmatrix} 0,6 \\ -0,8 \end{pmatrix},  \: \\
\vec{k}_{spinder} = \begin{pmatrix} -1 \\ 0 \end{pmatrix}, \:  \\
\vec{k}_{sover} = \begin{pmatrix} -0,8 \\ -0,6 \end{pmatrix}, \:  \\
\vec{k}_{gør} = \begin{pmatrix} -0,6 \\ -0,8 \end{pmatrix} \\
$$
Til disse værdier af vektorerne skal vi nu have beregnet værdien af tabsfunktionen $L$. 
Men lad os først visualisere vektorerne med en GeoGebra app, det både viser vektorerne og beregner værdien af tabsfunktionen.

{{< include _geogebra/_geogebra2.qmd >}}

::: {#fig-opg1}
:::: {.ggbContainer style='width:100%; margin: auto'}
::: {#ggbApplet_vektorer}
:::
:::
App til opgave 2.
:::

::: {.callout-note collapse="false" appearance="minimal"}
### Opgave 2: Leg med Geogebra appen.
 - Kontroller, at vektorerne på figuren passer til de værdier, vi valgte ovenfor.
 - Skriv ned, hvad værdien af tabsfunktionen er i udgangspunktet.
 - Ændr vektorerne, og bemærk af værdien af tabsfunktionen $L$ ændrer sig.
 - Overvej, hvordan du kan ændre vektorerne, så tabsfunktionen bliver mindst muligt. Vi vender tilbage til dette senere.
:::

Som det næste skal sandsynlighederne udregnes. F.eks. udregnes
$$
\begin{aligned}
P(\text{sover} \mid \text{hunden}) &= 
\frac{\mathrm{e}^{\vec{v}_{\text{hunden}} \cdot \vec{k}_{\text{sover}} }}
{\mathrm{e}^{\vec{v}_{\text{hunden}} \cdot \vec{k}_{\text{sover}} } +\mathrm{e}^{\vec{v}_{\text{hunden}} \cdot \vec{k}_{\text{gør}} } + \mathrm{e}^{\vec{v}_{\text{hunden}} \cdot \vec{k}_{\text{spinder}} }+\mathrm{e}^{\vec{v}_{\text{hunden}} \cdot \vec{k}_{\text{katten}}
}+\mathrm{e}^{\vec{v}_{\text{hunden}} \cdot \vec{k}_{\text{hunden}}
}} \\ \end{aligned}$$

::: {.callout-note collapse="false" appearance="minimal"}
### Opgave 3: Udregn sandsynligheder

- Kig grundigt på de 12 linjer i vores tekstkorpus, og overvej, hvilke sandsynligheder, der er relevante at udregne, fordi de optræder i teksten. Det er betydeligt færre end alle 25 kombinationer af de 5 ord, bl.a. fordi den samme kombination af ord optræder flere gange - f.eks. "Hunden sover".
- Udregn de sandsynligheder, som er relevante.

:::

Endeligt skal værdien af tabsfunktionen beregnes. Her skal de beregnede sandsynligheder anvendes. Da "Hunden sover" optræder to gange, kan værdien for denne kombination ganges med 2, "Hunden gør" optræder 3 gange osv.

$$L= -2 \cdot \ln(P(\text{sover} \mid \text{hunden})) -2 \cdot \ln(P(\text{hunden} \mid \text{sover})) -3 \cdot \ln(P(\text{gør} \mid \text{hunden})) - \cdots $$

::: {.callout-note collapse="false" appearance="minimal"}
### Opgave 4: Udregn værdien af tabsfunktionen

- Beregn værdien af tabsfunktionen $L$.
- Kontroller, at det stemmer med værdien fra GeoGebra appen inden du ændrede vektorerne.

:::

Lad os vende tilbage til optimering ved minimering af værdien af tabsfunktionen. Hvis vi ser på "Hunden" som fokusord, så skal "hunden", "katten" og "spinder" som kontekstord slet ikke anvendes, så deres kontekstvektorer skal være mest muligt modsat fokusvektoren for "Hunden". Derimod skal både "sover" og "gør" være tæt på "Hunden". 

Foretag lignende overvejelser for hvert fokusord, og forsøg så at placere både fokus- og kontekstvektorerne i GeoGebra appen ud fra disse overvejelser, f.eks. skal "sover" nok tættere på "Katten" end på "Hunden", da "Katten sover" optræder oftere end "Hunden sover" i teksten. 

Med lidt held og yderligere justeringer i appen, bør du kunne få værdien af tabsfunktionen så lav som mulig. 

::: {.callout-note collapse="false" appearance="minimal"}
### Opgave 5: Optimering

- Minimer værdien af tabsfunktionen ved at ændre vektorerne i GeoGebra.
- Beregn selv værdien af tabsfunktionen for de ændrede vektorer.
- Kontroller, at det stemmer med værdien i GeoGebra appen.
- Hvis I er flere, kan I jo se, hvem der kan få værdien mindst mulig.

:::


